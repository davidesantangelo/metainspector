<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>MetaInspector by jaimeiniesta</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>MetaInspector</h1>
        <h2>Ruby gem for web scraping purposes.</h2>
        <a href="https://github.com/jaimeiniesta/metainspector" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="metainspector---" class="anchor" href="#metainspector---" aria-hidden="true"><span class="octicon octicon-link"></span></a>MetaInspector <a href="http://travis-ci.org/jaimeiniesta/metainspector"><img src="https://secure.travis-ci.org/jaimeiniesta/metainspector.png" alt="Build Status"></a> <a href="https://gemnasium.com/jaimeiniesta/metainspector"><img src="https://gemnasium.com/jaimeiniesta/metainspector.png" alt="Dependency Status"></a> <a href="https://codeclimate.com/github/jaimeiniesta/metainspector"><img src="https://codeclimate.com/github/jaimeiniesta/metainspector/badges/gpa.svg" alt="Code Climate"></a>
</h1>

<p>MetaInspector is a gem for web scraping purposes.</p>

<p>You give it an URL, and it lets you easily get its title, links, images, charset, description, keywords, meta tags...</p>

<h2>
<a id="see-it-in-action" class="anchor" href="#see-it-in-action" aria-hidden="true"><span class="octicon octicon-link"></span></a>See it in action!</h2>

<p>You can try MetaInspector live at this little demo: <a href="https://metainspectordemo.herokuapp.com">https://metainspectordemo.herokuapp.com</a></p>

<h2>
<a id="changes-in-44" class="anchor" href="#changes-in-44" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes in 4.4</h2>

<p>The default headers now include <code>'Accept-Encoding' =&gt; 'identity'</code> to minimize trouble with servers that respond with malformed compressed responses, <a href="https://github.com/lostisland/faraday/issues/337">as explained here</a>.</p>

<h2>
<a id="changes-in-43" class="anchor" href="#changes-in-43" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes in 4.3</h2>

<ul>
<li>The Document API has been extended with one new method <code>page.best_title</code> that returns the longest text available from a selection of candidates.</li>
<li>
<code>to_hash</code> now includes <code>scheme</code>, <code>host</code>, <code>root_url</code>, <code>best_title</code> and <code>description</code>.</li>
</ul>

<h2>
<a id="changes-in-42" class="anchor" href="#changes-in-42" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes in 4.2</h2>

<ul>
<li>
<p>The images API has been extended, with two new methods:</p>

<ul>
<li>
<code>page.images.owner_suggested</code> returns the OG or Twitter image, or <code>nil</code> if neither are present.</li>
<li>
<code>page.images.largest</code> returns the largest image found in the page. This uses the HTML height and width attributes as well as the <a href="https://github.com/sdsykes/fastimage">fastimage</a> gem to return the largest image on the page that has a ratio squarer than 1:10 or 10:1. This usually provides a good alternative to the OG or Twitter images if they are not supplied.</li>
</ul>
</li>
<li><p>The criteria for <code>page.images.best</code> has changed slightly, we'll now return the largest image instead of the first image if no owner-suggested image is found.</p></li>
</ul>

<h2>
<a id="changes-in-41" class="anchor" href="#changes-in-41" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes in 4.1</h2>

<ul>
<li>Introduces the <code>:normalize_url</code> option, which allows to disable URL normalization.</li>
</ul>

<h2>
<a id="changes-in-40" class="anchor" href="#changes-in-40" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes in 4.0</h2>

<ul>
<li>The links API has been changed, now instead of <code>page.links</code>, <code>page.internal_links</code> and <code>page.external_links</code> we have:</li>
</ul>

<div class="highlight highlight-ruby"><pre>page.links.raw      <span class="pl-c"># Returns all links found, unprocessed</span>
page.links.all      <span class="pl-c"># Returns all links found, unrelavitized and absolutified</span>
page.links.http     <span class="pl-c"># Returns all HTTP links found</span>
page.links.non_http <span class="pl-c"># Returns all non-HTTP links found</span>
page.links.internal <span class="pl-c"># Returns all internal HTTP links found</span>
page.links.external <span class="pl-c"># Returns all external HTTP links found</span></pre></div>

<ul>
<li><p>The images API has been changed, now instead of <code>page.image</code> we have <code>page.images.best</code>, and instead of <code>page.favicon</code> we have <code>page.images.favicon</code>.</p></li>
<li><p>Now <code>page.image</code> will return the first image in <code>page.images</code> if no OG or Twitter image found, instead of returning <code>nil</code>.</p></li>
<li><p>You can now specify 2 different timeouts, <code>connection_timeout</code> and <code>read_timeout</code>, instead of the previous single <code>timeout</code>.</p></li>
</ul>

<h2>
<a id="changes-in-30" class="anchor" href="#changes-in-30" aria-hidden="true"><span class="octicon octicon-link"></span></a>Changes in 3.0</h2>

<ul>
<li>The redirect API has been changed, now the <code>:allow_redirections</code> option will expect only a boolean, which by default is <code>true</code>. That is, no more specifying <code>:safe</code>, <code>:unsafe</code> or <code>:all</code>.</li>
<li>We've dropped support for Ruby &lt; 2.</li>
</ul>

<p>Also, we've introduced a new feature:</p>

<ul>
<li>Persist cookies across redirects. Now MetaInspector will include the received cookies when following redirects. This fixes some cases where a redirect would fail, sometimes caught in a redirection loop.</li>
</ul>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>Install the gem from RubyGems:</p>

<div class="highlight highlight-bash"><pre>gem install metainspector</pre></div>

<p>If you're using it on a Rails application, just add it to your Gemfile and run <code>bundle install</code></p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">gem</span> <span class="pl-s1"><span class="pl-pds">'</span>metainspector<span class="pl-pds">'</span></span></pre></div>

<p>This gem is tested on Ruby versions 2.0.0 and 2.1.3.</p>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>Initialize a MetaInspector instance for an URL, like this:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://sitevalidator.com<span class="pl-pds">'</span></span>)</pre></div>

<p>If you don't include the scheme on the URL, http:// will be used by default:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>sitevalidator.com<span class="pl-pds">'</span></span>)</pre></div>

<p>You can also include the html which will be used as the document to scrape:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">"</span>http://sitevalidator.com<span class="pl-pds">"</span></span>, <span class="pl-c1">:document</span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>&lt;html&gt;&lt;head&gt;&lt;title&gt;Hello From Passed Html&lt;/title&gt;&lt;a href='/hello'&gt;Hello link&lt;/a&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;<span class="pl-pds">"</span></span>)</pre></div>

<h2>
<a id="accessing-response-status-and-headers" class="anchor" href="#accessing-response-status-and-headers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing response status and headers</h2>

<p>You can check the status and headers from the response like this:</p>

<div class="highlight highlight-ruby"><pre>page.response.status  <span class="pl-c"># 200</span>
page.response.headers <span class="pl-c"># { "server"=&gt;"nginx", "content-type"=&gt;"text/html; charset=utf-8", "cache-control"=&gt;"must-revalidate, private, max-age=0", ... }</span></pre></div>

<h2>
<a id="accessing-scraped-data" class="anchor" href="#accessing-scraped-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>Accessing scraped data</h2>

<p>You can see the scraped data like this:</p>

<div class="highlight highlight-ruby"><pre>page.url                 <span class="pl-c"># URL of the page</span>
page.scheme              <span class="pl-c"># Scheme of the page (http, https)</span>
page.host                <span class="pl-c"># Hostname of the page (like, sitevalidator.com, without the scheme)</span>
page.root_url            <span class="pl-c"># Root url (scheme + host, like http://sitevalidator.com/)</span>
page.title               <span class="pl-c"># title of the page from the head section, as string</span>
page.best_title          <span class="pl-c"># best title of the page, from a selection of candidates</span>
page.links.raw           <span class="pl-c"># every link found, unprocessed</span>
page.links.all           <span class="pl-c"># every link found on the page as an absolute URL</span>
page.links.http          <span class="pl-c"># every HTTP link found</span>
page.links.non_http      <span class="pl-c"># every non-HTTP link found</span>
page.links.internal      <span class="pl-c"># every internal link found on the page as an absolute URL</span>
page.links.external      <span class="pl-c"># every external link found on the page as an absolute URL</span>
page.meta[<span class="pl-s1"><span class="pl-pds">'</span>keywords<span class="pl-pds">'</span></span>]    <span class="pl-c"># meta keywords, as string</span>
page.meta[<span class="pl-s1"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span>] <span class="pl-c"># meta description, as string</span>
page.description         <span class="pl-c"># returns the meta description, or the first long paragraph if no meta description is found</span>
page.images              <span class="pl-c"># enumerable collection, with every img found on the page as an absolute URL</span>
page.images.best         <span class="pl-c"># Most relevant image, if defined with the og:image or twitter:image metatags. Fallback to the first page.images array element</span>
page.images.favicon      <span class="pl-c"># absolute URL to the favicon</span>
page.feed                <span class="pl-c"># Get rss or atom links in meta data fields as array</span>
page.charset             <span class="pl-c"># UTF-8</span>
page.content_type        <span class="pl-c"># content-type returned by the server when the url was requested</span></pre></div>

<h2>
<a id="meta-tags" class="anchor" href="#meta-tags" aria-hidden="true"><span class="octicon octicon-link"></span></a>Meta tags</h2>

<p>When it comes to meta tags, you have several options:</p>

<div class="highlight highlight-ruby"><pre>page.meta_tags  <span class="pl-c"># Gives you all the meta tags by type:</span>
                <span class="pl-c"># (meta name, meta http-equiv, meta property and meta charset)</span>
                <span class="pl-c"># As meta tags can be repeated (in the case of 'og:image', for example),</span>
                <span class="pl-c"># the values returned will be arrays</span>
                <span class="pl-c">#</span>
                <span class="pl-c"># For example:</span>
                <span class="pl-c">#</span>
                <span class="pl-c"># {</span>
                    <span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span> =&gt; {
                                <span class="pl-s1"><span class="pl-pds">'</span>keywords<span class="pl-pds">'</span></span>       =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>one, two, three<span class="pl-pds">'</span></span>],
                                <span class="pl-s1"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span>    =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>the description<span class="pl-pds">'</span></span>],
                                <span class="pl-s1"><span class="pl-pds">'</span>author<span class="pl-pds">'</span></span>         =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>Joe Sample<span class="pl-pds">'</span></span>],
                                <span class="pl-s1"><span class="pl-pds">'</span>robots<span class="pl-pds">'</span></span>         =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>index,follow<span class="pl-pds">'</span></span>],
                                <span class="pl-s1"><span class="pl-pds">'</span>revisit<span class="pl-pds">'</span></span>        =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>15 days<span class="pl-pds">'</span></span>],
                                <span class="pl-s1"><span class="pl-pds">'</span>dc.date.issued<span class="pl-pds">'</span></span> =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>2011-09-15<span class="pl-pds">'</span></span>]
                              },

                    <span class="pl-s1"><span class="pl-pds">'</span>http-equiv<span class="pl-pds">'</span></span> =&gt; {
                                        <span class="pl-s1"><span class="pl-pds">'</span>content-type<span class="pl-pds">'</span></span>        =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>text/html; charset=UTF-8<span class="pl-pds">'</span></span>],
                                        <span class="pl-s1"><span class="pl-pds">'</span>content-style-type<span class="pl-pds">'</span></span>  =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>text/css<span class="pl-pds">'</span></span>]
                                    },

                    <span class="pl-s1"><span class="pl-pds">'</span>property<span class="pl-pds">'</span></span> =&gt; {
                                    <span class="pl-s1"><span class="pl-pds">'</span>og:title<span class="pl-pds">'</span></span>        =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>An OG title<span class="pl-pds">'</span></span>],
                                    <span class="pl-s1"><span class="pl-pds">'</span>og:type<span class="pl-pds">'</span></span>         =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>website<span class="pl-pds">'</span></span>],
                                    <span class="pl-s1"><span class="pl-pds">'</span>og:url<span class="pl-pds">'</span></span>          =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>http://example.com/meta-tags<span class="pl-pds">'</span></span>],
                                    <span class="pl-s1"><span class="pl-pds">'</span>og:image<span class="pl-pds">'</span></span>        =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>http://example.com/rock.jpg<span class="pl-pds">'</span></span>,
                                                          <span class="pl-s1"><span class="pl-pds">'</span>http://example.com/rock2.jpg<span class="pl-pds">'</span></span>,
                                                          <span class="pl-s1"><span class="pl-pds">'</span>http://example.com/rock3.jpg<span class="pl-pds">'</span></span>],
                                    <span class="pl-s1"><span class="pl-pds">'</span>og:image:width<span class="pl-pds">'</span></span>  =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>300<span class="pl-pds">'</span></span>],
                                    <span class="pl-s1"><span class="pl-pds">'</span>og:image:height<span class="pl-pds">'</span></span> =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>300<span class="pl-pds">'</span></span>, <span class="pl-s1"><span class="pl-pds">'</span>1000<span class="pl-pds">'</span></span>]
                                   },

                    <span class="pl-s1"><span class="pl-pds">'</span>charset<span class="pl-pds">'</span></span> =&gt; [<span class="pl-s1"><span class="pl-pds">'</span>UTF-8<span class="pl-pds">'</span></span>]
                  }</pre></div>

<p>As this method returns a hash, you can also take only the key that you need, like in:</p>

<div class="highlight highlight-ruby"><pre>page.meta_tags[<span class="pl-s1"><span class="pl-pds">'</span>property<span class="pl-pds">'</span></span>]  <span class="pl-c"># Returns:</span>
                            <span class="pl-c"># {</span>
                            <span class="pl-c">#   'og:title'        =&gt; ['An OG title'],</span>
                            <span class="pl-c">#   'og:type'         =&gt; ['website'],</span>
                            <span class="pl-c">#   'og:url'          =&gt; ['http://example.com/meta-tags'],</span>
                            <span class="pl-c">#   'og:image'        =&gt; ['http://example.com/rock.jpg',</span>
                            <span class="pl-c">#                         'http://example.com/rock2.jpg',</span>
                            <span class="pl-c">#                         'http://example.com/rock3.jpg'],</span>
                            <span class="pl-c">#   'og:image:width'  =&gt; ['300'],</span>
                            <span class="pl-c">#   'og:image:height' =&gt; ['300', '1000']</span>
                            <span class="pl-c"># }</span></pre></div>

<p>In most cases you will only be interested in the first occurrence of a meta tag, so you can
use the singular form of that method:</p>

<div class="highlight highlight-ruby"><pre>page.meta_tag[<span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>]   <span class="pl-c"># Returns:</span>
                        <span class="pl-c"># {</span>
                        <span class="pl-c">#   'keywords'       =&gt; 'one, two, three',</span>
                        <span class="pl-c">#   'description'    =&gt; 'the description',</span>
                        <span class="pl-c">#   'author'         =&gt; 'Joe Sample',</span>
                        <span class="pl-c">#   'robots'         =&gt; 'index,follow',</span>
                        <span class="pl-c">#   'revisit'        =&gt; '15 days',</span>
                        <span class="pl-c">#   'dc.date.issued' =&gt; '2011-09-15'</span>
                        <span class="pl-c"># }</span></pre></div>

<p>Or, as this is also a hash:</p>

<div class="highlight highlight-ruby"><pre>page.meta_tag[<span class="pl-s1"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>][<span class="pl-s1"><span class="pl-pds">'</span>keywords<span class="pl-pds">'</span></span>]    <span class="pl-c"># Returns 'one, two, three'</span></pre></div>

<p>And finally, you can use the shorter <code>meta</code> method that will merge the different keys so you have
a simpler hash:</p>

<div class="highlight highlight-ruby"><pre>page.meta   <span class="pl-c"># Returns:</span>
            <span class="pl-c">#</span>
            <span class="pl-c"># {</span>
            <span class="pl-c">#   'keywords'            =&gt; 'one, two, three',</span>
            <span class="pl-c">#   'description'         =&gt; 'the description',</span>
            <span class="pl-c">#   'author'              =&gt; 'Joe Sample',</span>
            <span class="pl-c">#   'robots'              =&gt; 'index,follow',</span>
            <span class="pl-c">#   'revisit'             =&gt; '15 days',</span>
            <span class="pl-c">#   'dc.date.issued'      =&gt; '2011-09-15',</span>
            <span class="pl-c">#   'content-type'        =&gt; 'text/html; charset=UTF-8',</span>
            <span class="pl-c">#   'content-style-type'  =&gt; 'text/css',</span>
            <span class="pl-c">#   'og:title'            =&gt; 'An OG title',</span>
            <span class="pl-c">#   'og:type'             =&gt; 'website',</span>
            <span class="pl-c">#   'og:url'              =&gt; 'http://example.com/meta-tags',</span>
            <span class="pl-c">#   'og:image'            =&gt; 'http://example.com/rock.jpg',</span>
            <span class="pl-c">#   'og:image:width'      =&gt; '300',</span>
            <span class="pl-c">#   'og:image:height'     =&gt; '300',</span>
            <span class="pl-c">#   'charset'             =&gt; 'UTF-8'</span>
            <span class="pl-c"># }</span></pre></div>

<p>This way, you can get most meta tags just like that:</p>

<div class="highlight highlight-ruby"><pre>page.meta[<span class="pl-s1"><span class="pl-pds">'</span>author<span class="pl-pds">'</span></span>]     <span class="pl-c"># Returns "Joe Sample"</span></pre></div>

<p>Please be aware that all keys are converted to downcase, so it's <code>'dc.date.issued'</code> and not <code>'DC.date.issued'</code>.</p>

<h2>
<a id="other-representations" class="anchor" href="#other-representations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Other representations</h2>

<p>You can also access most of the scraped data as a hash:</p>

<div class="highlight highlight-ruby"><pre>page.to_hash    <span class="pl-c"># { "url"   =&gt; "http://sitevalidator.com",</span>
                    <span class="pl-s1"><span class="pl-pds">"</span>title<span class="pl-pds">"</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">"</span>MarkupValidator :: site-wide markup validation tool<span class="pl-pds">"</span></span>, ... }</pre></div>

<p>The original document is accessible from:</p>

<div class="highlight highlight-ruby"><pre>page.to_s         <span class="pl-c"># A String with the contents of the HTML document</span></pre></div>

<p>And the full scraped document is accessible from:</p>

<div class="highlight highlight-ruby"><pre>page.parsed  <span class="pl-c"># Nokogiri doc that you can use it to get any element from the page</span></pre></div>

<h2>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span class="octicon octicon-link"></span></a>Options</h2>

<h3>
<a id="timeout--retries" class="anchor" href="#timeout--retries" aria-hidden="true"><span class="octicon octicon-link"></span></a>Timeout &amp; Retries</h3>

<p>You can specify 2 different timeouts when requesting a page:</p>

<ul>
<li>
<code>connection_timeout</code> sets the maximum number of seconds to wait to get a connection to the page.</li>
<li>
<code>read_timeout</code> sets the maximum number of seconds to wait to read the page, once connected.</li>
</ul>

<p>Both timeouts default to 20 seconds each.</p>

<p>You can also specify the number of <code>retries</code>, which defaults to 3.</p>

<p>For example, this will time out after 10 seconds waiting for a connection, or after 5 seconds waiting
to read its contents, and will retry 4 times:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>www.google<span class="pl-pds">'</span></span>, <span class="pl-c1">:connection_timeout</span> =&gt; <span class="pl-c1">10</span>, <span class="pl-c1">:read_timeout</span> =&gt; <span class="pl-c1">5</span>, <span class="pl-c1">:retries</span> =&gt; <span class="pl-c1">4</span>)</pre></div>

<p>If MetaInspector fails to fetch the page after it has exhausted its retries,
it will raise <code>Faraday::TimeoutError</code>, which you can rescue in your
application code.</p>

<div class="highlight highlight-ruby"><pre><span class="pl-k">begin</span>
  page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(url)
<span class="pl-k">rescue</span> <span class="pl-s3">Faraday</span>::<span class="pl-vo">TimeoutError</span>
  enqueue_for_future_fetch_attempt(url)
  render_simple(url)
<span class="pl-k">else</span>
  render_rich(page)
<span class="pl-k">end</span></pre></div>

<h3>
<a id="redirections" class="anchor" href="#redirections" aria-hidden="true"><span class="octicon octicon-link"></span></a>Redirections</h3>

<p>By default, MetaInspector will follow redirects (up to a limit of 10).</p>

<p>If you want to disallow redirects, you can do it like this:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>facebook.com<span class="pl-pds">'</span></span>, <span class="pl-c1">:allow_redirections</span> =&gt; <span class="pl-c1">false</span>)</pre></div>

<h3>
<a id="headers" class="anchor" href="#headers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Headers</h3>

<p>By default, the following headers are set:</p>

<div class="highlight highlight-ruby"><pre>{
  <span class="pl-s1"><span class="pl-pds">'</span>User-Agent<span class="pl-pds">'</span></span>      =&gt; <span class="pl-s1"><span class="pl-pds">"</span>MetaInspector/<span class="pl-pse">#{</span><span class="pl-s2"><span class="pl-s3">MetaInspector</span>::<span class="pl-vo">VERSION</span></span><span class="pl-pse"><span class="pl-s2">}</span></span> (+https://github.com/jaimeiniesta/metainspector)<span class="pl-pds">"</span></span>,
  <span class="pl-s1"><span class="pl-pds">'</span>Accept-Encoding<span class="pl-pds">'</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">'</span>identity<span class="pl-pds">'</span></span>
}</pre></div>

<p>The <code>Accept-Encoding</code> is set to <code>identity</code> to avoid exceptions being raised on servers that return malformed compressed responses, <a href="https://github.com/lostisland/faraday/issues/337">as explained here</a>.</p>

<p>If you want to override the default headers then use the <code>headers</code> option:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># Set the User-Agent header</span>
page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>example.com<span class="pl-pds">'</span></span>, <span class="pl-c1">:headers</span> =&gt; {<span class="pl-s1"><span class="pl-pds">'</span>User-Agent<span class="pl-pds">'</span></span> =&gt; <span class="pl-s1"><span class="pl-pds">'</span>My custom User-Agent<span class="pl-pds">'</span></span>})</pre></div>

<h3>
<a id="html-content-only" class="anchor" href="#html-content-only" aria-hidden="true"><span class="octicon octicon-link"></span></a>HTML Content Only</h3>

<p>MetaInspector will try to parse all URLs by default. If you want to raise an exception when trying to parse a non-html URL (one that has a content-type different than text/html), you can state it like this:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>sitevalidator.com<span class="pl-pds">'</span></span>, <span class="pl-c1">:html_content_only</span> =&gt; <span class="pl-c1">true</span>)</pre></div>

<p>This is useful when using MetaInspector on web spidering. Although on the initial URL you'll probably have an HTML URL, following links you may find yourself trying to parse non-html URLs.</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://example.com/image.png<span class="pl-pds">'</span></span>)
page.content_type  <span class="pl-c"># "image/png"</span>
page.description   <span class="pl-c"># will returned a garbled string</span>

page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://example.com/image.png<span class="pl-pds">'</span></span>, <span class="pl-c1">:html_content_only</span> =&gt; <span class="pl-c1">true</span>)
page.content_type  <span class="pl-c"># "image/png"</span>
page.description   <span class="pl-c"># raises an exception</span></pre></div>

<h3>
<a id="url-normalization" class="anchor" href="#url-normalization" aria-hidden="true"><span class="octicon octicon-link"></span></a>URL Normalization</h3>

<p>By default, URLs are normalized using the Addressable gem. For example:</p>

<div class="highlight highlight-ruby"><pre><span class="pl-c"># Normalization will add a default scheme and a trailing slash...</span>
page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>sitevalidator.com<span class="pl-pds">'</span></span>)
page.url <span class="pl-c"># http://sitevalidator.com/</span>

<span class="pl-c"># ...and it will also convert international characters</span>
page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://www.詹姆斯.com<span class="pl-pds">'</span></span>)
page.url <span class="pl-c"># http://www.xn--8ws00zhy3a.com/</span></pre></div>

<p>While this is generally useful, it can be <a href="https://github.com/sporkmonger/addressable/issues/182">tricky</a> <a href="https://github.com/sporkmonger/addressable/issues/160">sometimes</a>.</p>

<p>You can disable URL normalization by passing the <code>normalize_url: false</code> option.</p>

<h3>
<a id="image-downloading" class="anchor" href="#image-downloading" aria-hidden="true"><span class="octicon octicon-link"></span></a>Image downloading</h3>

<p>When you ask for the largest image on the page with <code>page.images.largest</code>, it will be determined by its height and width attributes on the HTML markup, and also by downloading a small portion of each image using the <a href="https://github.com/sdsykes/fastimage">fastimage</a> gem. This is really fast as it doesn't download the entire images, normally just the headers of the image files.</p>

<p>If you want to disable this, you can specify it like this:</p>

<div class="highlight highlight-ruby"><pre>page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://example.com<span class="pl-pds">'</span></span>, <span class="pl-c1">download_images:</span> <span class="pl-c1">false</span>)</pre></div>

<h2>
<a id="exception-handling" class="anchor" href="#exception-handling" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exception Handling</h2>

<p>By default, MetaInspector will raise the exceptions found. We think that this is the safest default: in case the URL you're trying to scrape is unreachable, you should clearly be notified, and treat the exception as needed in your app.</p>

<p>However, if you prefer you can also set the <code>warn_level: :warn</code> option, so that exceptions found will just be warned on the standard output, instead of being raised.</p>

<p>You can also set the <code>warn_level: :store</code> option so that exceptions found will be silenced, and left for you to inspect on <code>page.exceptions</code>. You can also ask for <code>page.ok?</code>, wich will return <code>true</code> if no exceptions are stored.</p>

<p>You should avoid using the <code>:store</code> option, or use it wisely, as silencing errors can be problematic, it's always better to face the errors and treat them accordingly.</p>

<h2>
<a id="examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

<p>You can find some sample scripts on the <code>examples</code> folder, including a basic scraping and a spider that will follow external links using a queue. What follows is an example of use from irb:</p>

<div class="highlight highlight-ruby"><pre>$ irb
<span class="pl-k">&gt;&gt;</span> <span class="pl-k">require</span> <span class="pl-s1"><span class="pl-pds">'</span>metainspector<span class="pl-pds">'</span></span>
=&gt; <span class="pl-c1">true</span>

<span class="pl-k">&gt;&gt;</span> page <span class="pl-k">=</span> <span class="pl-s3">MetaInspector</span>.<span class="pl-k">new</span>(<span class="pl-s1"><span class="pl-pds">'</span>http://sitevalidator.com<span class="pl-pds">'</span></span>)
=&gt; <span class="pl-c">#&lt;MetaInspector:0x11330c0 @url="http://sitevalidator.com"&gt;</span>

<span class="pl-k">&gt;&gt;</span> page.title
=&gt; <span class="pl-s1"><span class="pl-pds">"</span>MarkupValidator :: site-wide markup validation tool<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span> page.meta[<span class="pl-s1"><span class="pl-pds">'</span>description<span class="pl-pds">'</span></span>]
=&gt; <span class="pl-s1"><span class="pl-pds">"</span>Site-wide markup validation tool. Validate the markup of your whole site with just one click.<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span> page.meta[<span class="pl-s1"><span class="pl-pds">'</span>keywords<span class="pl-pds">'</span></span>]
=&gt; <span class="pl-s1"><span class="pl-pds">"</span>html, markup, validation, validator, tool, w3c, development, standards, free<span class="pl-pds">"</span></span>

<span class="pl-k">&gt;&gt;</span> page.links.size
=&gt; <span class="pl-c1">15</span>

<span class="pl-k">&gt;&gt;</span> page.links[<span class="pl-c1">4</span>]
=&gt; <span class="pl-s1"><span class="pl-pds">"</span>/plans-and-pricing<span class="pl-pds">"</span></span></pre></div>

<h2>
<a id="contributing-guidelines" class="anchor" href="#contributing-guidelines" aria-hidden="true"><span class="octicon octicon-link"></span></a>Contributing guidelines</h2>

<p>You're more than welcome to fork this project and send pull requests. Just remember to:</p>

<ul>
<li>Create a topic branch for your changes.</li>
<li>Add specs.</li>
<li>Keep your fake responses as small as possible. For each change in <code>spec/fixtures</code>, a comment should be included explaining why it's needed.</li>
<li>Update <code>version.rb</code>, following the <a href="http://semver.org/">semantic versioning convention</a>.</li>
<li>Update <code>README.md</code> if needed (for example, when you're adding or changing a feature).</li>
</ul>

<p>Thanks to all the contributors:</p>

<p><a href="https://github.com/jaimeiniesta/metainspector/graphs/contributors">https://github.com/jaimeiniesta/metainspector/graphs/contributors</a></p>

<p>You can also come to chat with us on our <a href="https://gitter.im/jaimeiniesta/metainspector">Gitter room</a> and <a href="https://groups.google.com/forum/#!forum/metainspector">Google group</a>.</p>

<h2>
<a id="related-projects" class="anchor" href="#related-projects" aria-hidden="true"><span class="octicon octicon-link"></span></a>Related projects</h2>

<ul>
<li>
<a href="https://github.com/fern4lvarez/go-metainspector">go-metainspector</a>, a port of MetaInspector for Go.</li>
<li>
<a href="https://github.com/gabceb/node-metainspector">Node-MetaInspector</a>, a port of MetaInspector for Node.</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>MetaInspector is released under the <a href="MIT-LICENSE">MIT license</a>.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/jaimeiniesta/metainspector/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/jaimeiniesta/metainspector/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/jaimeiniesta/metainspector"></a> is maintained by <a href="https://github.com/jaimeiniesta">jaimeiniesta</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
